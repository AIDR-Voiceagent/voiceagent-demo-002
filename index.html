<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Voice Demo</title>

    <style>
        body {
            margin: 0;
            background-color: #000;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            height: 100vh;
            overflow-x: hidden;
        }

        .container {
            margin-top: 40px;
            width: 80%;
            max-width: 900px;
            text-align: center;
        }

        h1 {
            margin-bottom: 20px;
            font-size: 28px;
            font-weight: 600;
        }

        button {
            background-color: #222;
            color: white;
            padding: 10px 28px;
            border-radius: 8px;
            border: 1px solid #444;
            cursor: pointer;
            margin: 6px;
            font-size: 16px;
        }

        button:hover {
            background-color: #333;
        }

        .mic-bubble {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 2px solid gray;
            margin: 25px auto 15px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 600;
            font-size: 18px;
            transition: 0.3s;
            background-color: #111;
        }

        .mic-active {
            border-color: #00ffaa;
            box-shadow: 0 0 10px #00ffaa;
        }

        .volume-bar {
            width: 200px; /* kürzer wie im Screenshot */
            height: 6px;
            background-color: #333;
            border-radius: 5px;
            margin: 5px auto 12px auto;
            position: relative;
        }

        .volume-fill {
            width: 0%;
            height: 100%;
            background-color: #00ffaa;
            border-radius: 5px;
        }

        .transcript-title {
            margin-top: 15px;
            font-size: 16px;
            font-weight: 600;
            opacity: 0.9;
        }

        .transcript-box {
            width: 260px; /* NICHT breit – wie im Screenshot */
            height: 180px; /* kleiner und rechteckiger */
            background-color: #111;
            border-radius: 10px;
            margin: 10px auto 0 auto;
            overflow-y: auto;
            padding: 12px;
            text-align: left;
            font-size: 14px;
            border: 1px solid #333;
        }

        .msg-user {
            color: #00ffaa;
            margin-bottom: 8px;
        }
        .msg-agent {
            color: #fff;
            opacity: 0.9;
            margin-bottom: 8px;
        }
    </style>
</head>

<body>
<div class="container">
    <h1>AI Voice Demo</h1>

    <button id="connectBtn">Verbinden</button>
    <button id="disconnectBtn">Stop</button>

    <div id="errorMsg" style="margin-top: 10px; color: #ff5555;"></div>

    <div class="mic-bubble" id="micBubble">MIC</div>

    <div class="volume-bar">
        <div class="volume-fill" id="volFill"></div>
    </div>

    <div class="transcript-title">Transkript</div>
    <div class="transcript-box" id="transcriptBox"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@11labs/client@latest/dist/browser/elevenlabs.umd.js"></script>

<script>
    let client;
    let session;

    const connectBtn = document.getElementById("connectBtn");
    const disconnectBtn = document.getElementById("disconnectBtn");
    const micBubble = document.getElementById("micBubble");
    const volFill = document.getElementById("volFill");
    const transcriptBox = document.getElementById("transcriptBox");
    const errorMsg = document.getElementById("errorMsg");

    const PUBLIC_KEY = "3857a4fd-9664-470b-b523-759ca2db2753";
    const ASSISTANT_ID = "9939aaaf-23ff-490a-8daf-665758ff117b";

    function addTranscriptMessage(text, sender) {
        const div = document.createElement("div");
        div.className = sender === "user" ? "msg-user" : "msg-agent";
        div.textContent = text;
        transcriptBox.appendChild(div);
        transcriptBox.scrollTop = transcriptBox.scrollHeight;
    }

    connectBtn.addEventListener("click", async () => {
        try {
            errorMsg.textContent = "";

            client = new ElevenLabs.Client({ apiKey: PUBLIC_KEY });

            session = await client.realtime.connect({
                agentId: ASSISTANT_ID,
                onOpen: () => console.log("Verbindung geöffnet"),
                onError: (e) => errorMsg.textContent = "Fehler beim Verbinden",
                onClose: () => console.log("Verbindung geschlossen"),
            });

            session.on("message", (msg) => {
                if (msg.type === "response.input_text.delta") {
                    addTranscriptMessage(msg.delta, "agent");
                }
            });

            session.startSession();

            micBubble.classList.add("mic-active");

        } catch (err) {
            errorMsg.textContent = "Fehler beim Verbinden";
        }
    });

    disconnectBtn.addEventListener("click", () => {
        try {
            if (session) session.close();
        } catch {}

        micBubble.classList.remove("mic-active");
    });

</script>

</body>
</html>


